<!DOCTYPE html>
<html>
  <head>
    <title>ProblemView</title>
    <meta content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    
    <link href="../resources/styles/bootstrap.min.css" rel="stylesheet" media="screen">
    <script src="../resources/scripts/bootstrap.min.js"></script>
    <script src="../resources/scripts/jquery.js"></script>
    <script src="../resources/scripts/jquery.loadTemplate-1.3.2.min.js"></script>
    
    <style>
    body{
       margin-bottom: 40px;
    }
    </style>
    <script>	
    function getSolutions(url){
		$.ajax({
			url: url,
			type: "get",
			dataType: "json",
			success: function(result){
			
			$("#problem").html("");
			$("#solutionList").html("");
				//data=result.data;
				//alert(result.problem.id);
				var problem=result.problem;
					var problemId=problem.id;
					var when=problem.description.when;
					var who=problem.description.who;
					var how=problem.description.how;
					var why=problem.description.why;
					var consequences=problem.description.consequences;
					var where=problem.description.where;
					var postedDate=problem.postedDate;
					var author=problem.author,name

					var length=0;
					
					$("#answer").attr("href","solutionForm.html?id="+problemId+"&redirect=solutionView.html");

					if(problem.isProblem){
						
					
					$("#problem").loadTemplate("template/strucView.html",
					{
						authorPic: '../resources/img/avatar.png',
						author: author,
						when: when,
					    who: who,
					    how: how,
					    why: why,
					    consequences: consequences,
					    where: where,
					    postedDate: postedDate
					});
					
					$("#problem").show();
					}
					
					else{
						
						$("#solutionList").append("<div id='solution"+problemId+"'></div>");
						$("#solution"+problemId).loadTemplate("template/strucView.html",
						{
							authorPic: '../resources/img/avatar.png',
							author: author,
							when: when,
						    who: who,
						    how: how,
						    why: why,
						    consequences: consequences,
						    where: where,
						    postedDate: postedDate
						});
						
						$("#solutionList").show();
						
						length++;
						
					}
				var solutions=result.solutions;
				length+=solutions.length;
				
				$("#solutionsNum").html(length+" solutions");
				
				//alert(solutions.length);
				for(var i=0;i<solutions.length;i++){

					$("#solutionList").show();

					var id=solutions[i].id;
					when=solutions[i].description.when;
					who=solutions[i].description.who;
					how=solutions[i].description.how;
					why=solutions[i].description.why;
					consequences=solutions[i].description.consequences;
					where=solutions[i].description.where;
					postedDate=solutions[i].postedDate;
					author=solutions[i].author,name
								
					$("#solutionList").append("<div id='solution"+id+"'></div>");
					$("#solution"+id).loadTemplate("template/strucView.html",
					{
						authorPic: '../resources/img/avatar.png',
						author: author,
						when: when,
					    who: who,
					    how: how,
					    why: why,
					    consequences: consequences,
					    where: where,
					    postedDate: postedDate
					});
			}
							
				$("#container").show();
			}
			});
		}	
	
    $(function(){
    	
	 	var prmstr = window.location.search.substr(1);
	    var prmarr = prmstr.split ("&");
	    var params = {};

	    for ( var i = 0; i < prmarr.length; i++) {
	        var tmparr = prmarr[i].split("=");
	        params[tmparr[0]] = decodeURIComponent(tmparr[1]);
	    }
	    var id=params['id'];
	    
    	getSolutions("/SelfCareCommunity/service/problem/"+id+"/solutions");	

    });
   </script>

 </head>
 <body>

 <div id="new-header">
        <script>
            $("#new-header").load("header.html");
        </script>
</div>


<div id="container"  style="display:none;" class="span9 offset3">

<div id="problem" style="display:none"></div>

<h4 id="solutionsNum"></h4>
<hr />

<div id="solutionList" style="display:none" class="well">
</div>


<a id="answer" class="btn btn-info pull-right" href="" >Answer</a>

</div>

 </body>
</html>